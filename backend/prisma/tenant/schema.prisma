// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š SCHEMA TENANT DB AVEC USAGE EVENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/.prisma/tenant"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ« DONNÃ‰ES MÃ‰TIER (EXISTANT - INCHANGÃ‰)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Ticket {
  id          String         @id @default(cuid())
  // NumÃ©ro de ticket lisible (sÃ©quentiel par tenant)
  ticketNumber String        @unique
  title       String
  description String
  status      TicketStatus   @default(OPEN)
  priority    TicketPriority @default(MEDIUM)

  authorId     String // User ID de la DB control
  assignedToId String? // User ID de la DB control

  comments Comment[]

  // ğŸ“Š Usage tracking - Nouveau
  usageEvents UsageEvent[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("tickets")
}

model Comment {
  id       String @id @default(cuid())
  body     String
  ticketId String
  authorId String // User ID de la DB control

  ticket Ticket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  // ğŸ“Š Usage tracking - Nouveau
  usageEvents UsageEvent[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("comments")
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š USAGE EVENTS (NOUVEAU)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model UsageEvent {
  id String @id @default(cuid())

  // Event details
  eventType  UsageEventType
  entityType EntityType
  entityId   String

  // Metrics
  incrementValue Int @default(1) // Combien on ajoute

  // User context
  userId String // User qui a dÃ©clenchÃ© l'action

  // Relations optionnelles
  ticketId  String?
  commentId String?

  ticket  Ticket?  @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  comment Comment? @relation(fields: [commentId], references: [id], onDelete: Cascade)

  // Sync status
  syncedToControl Boolean   @default(false)
  syncedAt        DateTime?

  createdAt DateTime @default(now())

  @@map("usage_events")
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š ENUMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum UsageEventType {
  CREATE
  UPDATE
  DELETE
  VIEW
  EXPORT
}

enum EntityType {
  TICKET
  COMMENT
  USER
  ATTACHMENT
  API_CALL
}
