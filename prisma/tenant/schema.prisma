generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/.prisma/tenant"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Ticket {
  id          String         @id @default(cuid())
  title       String
  description String
  status      TicketStatus   @default(OPEN)
  priority    TicketPriority @default(MEDIUM)

  // CHANGEMENT: Référence vers User central (ID seulement)
  authorId     String // User ID de la DB control
  assignedToId String? // User ID de la DB control

  // Relations locales uniquement
  comments Comment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("tickets")
}

model Comment {
  id       String @id @default(cuid())
  body     String
  ticketId String
  authorId String // User ID de la DB control

  // Relations
  ticket Ticket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("comments")
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}
